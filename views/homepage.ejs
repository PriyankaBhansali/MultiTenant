<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>281 - Team 22</title>

	<link rel="stylesheet" type="text/css" href="/stylesheets/bootstrap/css/bootstrap.min.css" />
	<link rel="stylesheet" type="text/css" href="/stylesheets/font-awesome/css/font-awesome.min.css" />
	<link rel="stylesheet" type="text/css" href="/stylesheets/css/local.css" />

	<script type="text/javascript" src="/stylesheets/js/jquery-1.10.2.min.js"></script>
	<script type="text/javascript" src="/stylesheets/bootstrap/js/bootstrap.min.js"></script>   

	<script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
	<script src="http://code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
	<script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.2.26/angular.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>     
</head>

<body ng-app="" ng-controller="loginController" background="/images/db.jpg">
	<div>
		<div class="modal-body row" ng-show="signInPageShow">
			<div class="container im-centered">
			
				<div class="col-md-12">
					<div class="main-well">
						<div class="row text-center main-title">
							<h1> Multi-Tenant System</h1>
						</div>
					</div>
				</div>

			<div class="col-md-6 main">

				<div class="container" id="wrap">
					<div class="row">
						<div class="col-md-4">
							<form method="post" accept-charset="utf-8" class="form" role="form">   <legend>Sign Up</legend>
								<div class="row">
									<div class="col-xs-6 col-md-6">
										<input type="text" name="firstname" value="" class="form-control input-lg" placeholder="First Name"  />                       
									</div>
									<div class="col-xs-6 col-md-6">
										<input type="text" name="lastname" value="" class="form-control input-lg" placeholder="Last Name"  />                  
									</div>
								</div>
								<br>
								<input type="text" name="email" value="" class="form-control input-lg" placeholder="Your Email"  /><br><input type="password" name="password" value="" class="form-control input-lg" placeholder="Password"  /><br>

								<div class="row">
									<div class="col-xs-4 col-md-3">
										<label>Model Type</label>
									</div>                           
									<div class="col-xs-4 col-md-4">
										<select name="model type" class = "form-control input-lg">
											<option value="01">Kanban</option>
											<option value="02">Waterfall</option>
											<option value="03">Scrum</option>
										</select>                        </div>
									</div>
									<br>

									<span class="help-block">By clicking Create my account, you agree to our Terms and that you have read our Data Use Policy, including our Cookie Use.</span>
									<!-- <input type = "button" onClick="/signup/kanban/create" class="btn btn-lg btn-block signup-btn" type="submit"> -->
									<button type="submit" ng-click="login()" class="btn btn-primary btn-block">Sign Up</button>	
								</div>
							</form>
						</div>
					</div>
				</div>  
			
				<div class="col-md-6 main-grid"> 

					<div class="main-well">	
						<form class="form-horizontal">  					
							<fieldset>    			
								<h4> Login here </h4><br>										
								<div class="form-group">      
									<div class="col-lg-12">
										<input type="email" ng-model="inputEmail" class="form-control" id="inputEmail" placeholder="Email address" required>  
									</div>
								</div>

								<div class="form-group">
									<div class="col-lg-12">      							
										<input type="password" ng-model="inputPassword" class="form-control" id="inputPassword" placeholder="Password (6 or more characters)" required>
									</div>
								</div>
								<br>

								<div class="form-group">
									<div class="col-lg-12">								
										<p>									
											<button type="submit" ng-click="login()" class="btn btn-primary btn-block">Login</button>	
									</div>
								</div>
							</fieldset>
						</form>
					</div>
				</div> 

        	</div>
    	</div>

	    <div ng-show="projectPageShow">
	     	<div class="row">
				<div class="col-md-9 row text-center">
					<h2> Project List </h2>
				</div>
				<div class="col-md-3 row text-center"> 
					<button type="button" class="btn-lg btn-warning" ng-click="switchToEdit()">
						Create Project
					</button>

					<div class="col-lg-12" ng-show="true">
						<input type="text" ng-model="projectName" ng-click="createproject()" placeholder="Project name" required>  
					</div>
					    
				</div>
			</div>                
				<br>            
			<div class="row">  
				<div class="col-md-2">
				</div>
				<div class="col-md-10">
					<select name="model type" class="place_holder dropdown" ng-model="project" ng-change="selectProject(project)" style='width: 30%; height: 30%'>
						<option ng:repeat="project in projects" value="{{project.projectName}}">{{project.projectName}}</option>
	            	</select>
				</div>

					<br><br><br><br><br><br>
			</div>
		</div>

	    <div id="wrapper" ng-show="waterfallPageShow">
	        <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
	            <div class="navbar-header">
	                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
	                    <span class="sr-only">Toggle navigation</span>
	                    <span class="icon-bar"></span>
	                    <span class="icon-bar"></span>
	                    <span class="icon-bar"></span>
	                </button>
	                <a class="navbar-brand" href="index.html">Back to Admin</a>
	            </div>
	            <div class="collapse navbar-collapse navbar-ex1-collapse">
	                <ul class="nav navbar-nav side-nav">
	                    <li><a href="./"><i class="fa fa-bullseye"></i> Dashboard</a></li>
	                    
	                    <li  class="active"><a href="./searchGuards"><i class="fa fa-tasks"></i> Tasks</a></li>
	                    
	                    <li><a href="./searchClients"><i class="fa fa-globe"></i> Status</a></li>
	                    <li><a href="./displaySchedule? Not sure"><i class="fa fa-list-ol"></i> Schedule</a></li>
	                    <li><a href="./searchBuildings"><i class="fa fa-globe"></i> Buildings</a></li>                    
	                </ul>
	                <ul class="nav navbar-nav navbar-right navbar-user">                    
	                    <li><a href="./logout"><i class="fa fa-power-off"></i> Log Out</a></li>                       
	                </ul>
	            </div>
	        </nav>
	    	<div class="row">
	        	<div class="modal-body" ng-show="showMode">           
	            	<div class="row text-center">
	                	<h2> Task Details </h2>
	            	</div>
	        	</div>
	        	<br>  

	    		<div class="col-md-6" ng-repeat="task in tasks"> 
	        		<div class="scrollit" ng-show = 'visible[task.taskId]'>
	            		<table border="1">
	                		<div class="content">                   
	                    		<form class="form-horizontal">                      
	                        		<fieldset>    
	                            		<div class="form-group">      
	                                		<label class="col-md-5">
	                                    		Task ID:
		                                	</label>
	    	                            	<div class="col-md-6">
	        	                            	<p class="form-control-static">{{task.taskId}}</p>
	            	                    	</div>
	                	            	</div>

	                            		<div class="form-group">      
	                                		<label class="col-md-5">
		                                    	Task Name:
	    	                            	</label>
	        	                        	<div class="col-md-6">
	            	                        	<p class="form-control-static">{{task.taskName}}</p>
	                	                	</div>
	                    	        	</div>

		                            	<div class="form-group">      
	    	                            	<label class="col-md-5">
	        	                            	Duration:
	            	                    	</label>
	                	                	<div class="col-md-6">
	                    	                	<p class="form-control-static">{{task.duration}}</p>
	                        	        	</div>
	                            		</div>
	                            		<div class="form-group">
		                                	<label class="col-md-5">
	    	                                	Start Date:
	        	                        	</label>
	            	                    	<div class="col-md-6">
	                	                    	<p class="form-control-static">{{task.startDate}}</p>
	                    	            	</div>
	                        	    	</div>
		                            		<div class="form-group">
	    	                            	<label class="col-md-5">
	        	                            	End Date:
	            	                    	</label>
	                	                	<div class="col-md-6">                
	                    	                	<p class="form-control-static">{{task.endDate}}</p>                        
	                        	        	</div>
	                            		</div>
	                            		<div class="form-group">      
		                                	<label class="col-md-5">
	    	                                	Predecessors:
	        	                        	</label>
	            	                    	<div class="col-md-6">
	                	                    	<p class="form-control-static">{{task.predecessors}}</p>
	                    	            	</div>
	                        	    	</div>
	                            		<div class="form-group">      
	                                		<label class="col-md-5">
	                                    		Resources allocated:
		                                	</label>
	    	                            	<div class="col-md-6">
	        	                            	<p class="form-control-static">{{task.resources}}</p>
	            	                    	</div>
	                	            	</div>
	                    	        	<div class="form-group">      
	                        	        	<label class="col-md-5">
	                            	        	Risks:
	                                		</label>
	                                		<div class="col-md-6">
		                                    	<p class="form-control-static">{{task.risks}}</p>
	    	                            	</div>
	        	                    	</div>
	            	                	<div class="form-group">      
	                	                	<label class="col-md-5">
	                    	                	% Completed:
	                        	        	</label>
	                            	    	<div class="col-md-6">
	                                	    	<p class="form-control-static">{{task.completed}}</p>
	                                		</div>
		                            	</div>
	    	                    	</fieldset>
	                    		</form>
		                	</div>
							<div class="row"> 
	        	            	<label class='col-md-1'></label>
	            	        	<div class="col-md-3"> 
	                	        	<button type="button" class="btn btn-primary" ng-click="editTask(task.taskId)">
	                    	        	Edit Client
	                        		</button>
		                    	</div>
	    	                	<div class="col-md-2"> 
	        	                	<button type="button" class="btn btn-danger" ng-click ="deleteTask(task.taskId)">
	            	                	Delete Client
	                	        	</button>
	                    		</div> 
	                		</div>
						</table>
	        		</div>
	         		<div id="create" ng-hide="visible[task.taskId]">            
	            		<div class="row text-center">
	            			<h2>Edit Task</h2>
		            	</div>
	    	        	<div class="col-md-10 container">                           
	        	        	<div class="content">                   
	            	        	<form class="form-horizontal">                      
	                	        	<fieldset>    
	                    	        	<div class="form-group">      
	                        	        	<label class="col-md-3">
	                            	        	Task ID:
	                                		</label>
	                                		<div class="col-md-6">
	                                    		<p class="form-control-static">{{task.taskId}}</p>
		                                	</div>
	    	                        	</div>
	        	                    	<div class="form-group">      
	            	                    	<label class="col-md-3">
	                	                    	Task Name:
	                    	            	</label>
	                        	        	<div class="col-md-6">
	                            	        	<input type="text" class="form-control" ng-model="task.taskName">
	                                		</div>
	                            		</div>
	                            		<div class="form-group">      
		                                	<label class="col-md-3">
	    	                                	Duration:
	        	                        	</label>
	            	                    	<div class="col-md-6">
	                	                    	<input type="text" class="form-control"  ng-model="task.duration"/>
	                    	            	</div>
	                        	    	</div>
	                            		<div class="form-group">
	                                		<label class="col-md-3">
	                                    		Start Date:
	                                		</label>
		                                	<div class="col-md-6">                
	    	                                	<div id='startDate'>
	        	                                	<input type='date' class="form-control" ng-model="task.startDate"/>
	            	                        	</div>                        
	                	                	</div>
	                    	        	</div>
	                        	    	<div class="form-group">
	                            	    	<label class="col-md-3">
	                                	    	End Date:
	                                		</label>
		                                	<div class="col-md-6">                
	    	                                	<div id='endDate'>
	        	                                	<input type='date' class="form-control" ng-model="task.endDate"/>
	            	                        	</div>                        
	                	                	</div>
	                    	        	</div>  
	                        	    	<div class="form-group">      
	                            	    	<label class="col-md-3">
	                                	    	Predecessors for this task:
	                                		</label>
		                                	<div class="col-md-6">
	    	                                	<input type="text" class="form-control" ng-model="task.predecessors"/>
	        	                        	</div>
	            	                	</div>
	                	            	<div class="form-group">      
	                    	            	<label class="col-md-3">
	                        	            	Resources allocated to this task:
	                            	    	</label>
	                                		<div class="col-md-6">
	                                    		<input type="text" class="form-control" ng-model="task.resources"/>
		                                	</div>
	    	                        	</div>
	        	                    	<div class="form-group">      
	            	                    	<label class="col-md-3">
	                	                    	Risks
	                    	            	</label>
	                        	        	<div class="col-md-6">
	                            	        	<input type="text" class="form-control" ng-model="task.risks"/>
	                                		</div>
	                            		</div>
		                            	<div class="form-group">      
	    	                            	<label class="col-md-3">
	        	                            	% Completed
	            	                    	</label>
	                	                	<div class="col-md-6">
	                    	                	<input type="text" class="form-control" ng-model="task.completed"/>
	                        	        	</div>
	                            		</div>
	                            		<div class="row text-center">
		                            		<button type="submit" class="btn btn-info" ng-click="saveTask(task)">
	    	                        			Save changes
	        	                    		</button>
	            	                		<button class="btn btn-warning" ng-click = "visible[task.taskId] = !visible[task.taskId]">
		                            			Cancel
	    	                        		</button>
	        	                    	</div>
	            	            	</fieldset>
	                	    	</form> 
	                		</div>
	            		</div>                  
		        	</div>
	    		</div>
			</div>
		</div>

		<div class="modal-body" id="clientDetails" ng-show = "scrumPageShow">           

			<div class="row">
				<div class="col-md-3 row text-center">
					<button type="button" class="btn-sm btn-primary" ng-click="switchToEdit()">
						Add Sprint
					</button>
				</div>

				<div class="col-md-7 row text-center">
					<h2> Backlog Details </h2>
				</div>
			</div>                
			<br>   
			<div class="row">
				<div class="col-md-2"> 
				</div>
				<div class="col-md-8"> 
					<table border="1">
						<div class="content"><h3><input type="text" class="form-control" placeholder="Backlog name" id="text" ng-model="text"/></h3>     
						</div>
					</table>
				</div>
			</div>
			<div class="row">
				<div class="col-md-1">
				</div> 
				<div class="col-md-10"> 
					<div class="scrollit">

						<table style='table-layout:fixed;width:100%;height:100px' border='1'>
							<tr style='height: 45px;'>
								<th style='width: 10%;'>ID</th>
								<th style='width: 12%;'>User Story</th>
								<th style='width: 12%;'>Acceptable Criteria</th>
								<th style='width: 12%;'>Sprint</th>
								<th style='width: 30%;'>Comments</th>
								<th style='width: 8%;'>Days</th>
								<th style='width: 8%;'>Points</th>
								<th style='width: 9%;'>Cost</th>
								<th style='width: 8%;'></th>
							</tr>
							<br>
							<tr style='height: 45px;' ng-repeat="userStory in userStories" ng-show="visible2[userStory.id]">
								<th style='width: 10%;'><p>{{userStory.id}}</p></th>
								<th style='width: 15%;'><p>{{userStory.name}}</p></th>
								<th style='width: 15%;'><p>{{userStory.acceptanceCriteria}}</p></th>

								<!--th style='width: 15%;'> 
									<select name="model type" default='b' class = "form-control">
										<option value="01" ng-repeat = "sprint in sprints" value='sprint'>{{userStory.sprint}}</option>
									</select>
								</th-->
								<th style='width: 130%;'><p>{{userStory.sprint}}</p></th>
								<th style='width: 130%;'><p>{{userStory.comments}}</p></th>
								<th style='width: 8%;'><p>{{userStory.days}}</p></th>
								<th style='width: 8%;'><p>{{userStory.points}}</p></th>
								<th style='width: 9%;'><p>{{userStory.cost}}</p></th>
								<th type="button" ng-click="editUserStory(userStory.id)" class="btn btn-primary btn-block">Edit </th>
							</tr>


							<tr style='height: 45px;' ng-repeat="userStory in userStories" ng-show="!visible2[userStory.id]">
								<th style='width: 10%;'><input type="text" class="form-control" id="text" ng-model="userStory.id"/></th>
								<th style='width: 15%;'><input type="text" class="form-control" id="text" ng-model="userStory.name"/></th>
								<th style='width: 15%;'><input type="text" class="form-control" id="text" ng-model="userStory.acceptanceCriteria"/></th>

								<th style='width: 15%;'> 
									<select name="model type" default='b' class = "form-control">
										<option value="01" ng-repeat = "sprint in sprints" value='sprint'>{{sprint}}</option>
									</select>
								</th>
								<th style='width: 130%;'><input type="text" class="form-control" id="text" ng-model="userStory.comments"/></th>
								<th style='width: 8%;'><input type="text" class="form-control" id="text" ng-model="userStory.days"/></th>
								<th style='width: 8%;'><input type="text" class="form-control" id="text" ng-model="userStory.points"/></th>
								<th style='width: 9%;'><input type="text" class="form-control" id="text" ng-model="userStory.cost"/></th>
								<th type="button" ng-click="editUserStory(userStory.id)" class="btn btn-primary btn-block">Cancel </th>
							</tr>

							<br>
						</table>   
					</div>
				</div>
			</div>
		</div>
	</div>
</body>

	<script>
		function loginController($scope, $http, $location) {
			$scope.projectPageShow = false;
            $scope.createProjMode  = false;
            $scope.signInPageShow = true;
            $scope.waterfallPageShow = false;
            $scope.scrumPageShow = false;

            //For Waterfall..
            $scope.tasks=[];
        	$scope.visible = [];

        	//For Scrum
        	$scope.userStories = [];
    		$scope.sprints = [];
    		$scope.editbacklog  = false;
    		$scope.visible2 = [];
             
             $scope.createproject = function(){
             	$scope.createProjMode  = true;

             }


			$scope.login = function() {
					
				$http({
					method: 'POST',
					url: '/signIn',
					data: { "email": $scope.inputEmail, "password": $scope.inputPassword }	            
				}).success(function(res){	           
					// alert(JSON.stringify(res));	
					console.log(res);            
					if(res.status == "Success")
					{	     
						console.log('Sending backend call for projects');
						$scope.getProjects(); 
					}	            	       
					else
					{
						alert(res.status);
						
					}	            	
				}).error(function(error){
					alert(res.Status);
				});
			};


			$scope.getProjects = function() {
				$http({
					method: 'GET',
					url: '/getProjects'
				}).success(function(res){	           
					console.log(res);	            
					if(res.status == "Success")
					{	           			
						$scope.projectPageShow = true;
						$scope.signInPageShow  = false;
						$scope.projects = res.projects;
					}	            	       
					else
					{
						alert(res.error);
					}	            	
				}).error(function(error){
					alert(res.Status);
				});
			};

			$scope.selectProject = function(projectName){
				$http({
					method : "POST",
					url : '/selectProject',
					data : {'projectName':projectName}
				}).success(function(res){
					console.log(res);
					console.log(res.modelType);
					if(res.modelType === 'waterfall'){
						$scope.Waterfall(res);
					} else if (res.modelType === 'scrum'){
						$scope.scrumInit(res);
					} else {
						console.log('Its by mistake.. :)');
						window.location = "/loadCards";
					}
				})
			}

			$scope.Waterfall = function(res){
				$scope.tasks = res.data[0].tasks;
				$scope.projectPageShow = false;
            	$scope.createProjMode  = false;
            	$scope.signInPageShow = false;
            	$scope.scrumPageShow = false;
            	$scope.waterfallPageShow = true;
                
                console.log($scope.tasks);
                for(var i=0; i<$scope.tasks.length;i++){
                    $scope.visible[$scope.tasks[i].taskId] = true;
                }
			}

			$scope.editTask = function(taskId){
            	$scope.visible[taskId]=!$scope.visible[taskId];
        	}

        	$scope.saveTask = function(task){
            	// task.userId = 'k.praveen@outlook.com';
            	// task.projectName = 'Test1'
            	console.log(task);

            	$http({
                	method : 'PUT',
                	url : '/updateTask',
                	data : task
            	}).success(function(res){
                	console.log(res);
                	if(res.status === 'Failed'){
                    	alert(res.error);
                	} else {
                    	alert('Saved successfully.');
                    	$scope.visible[task.taskId]=!$scope.visible[task.taskId];
                	}
            	})
        	}

        	//functions for Scrum..
        	$scope.getSprints = function(){
        		$http({
            		method : 'GET',
            		url : '/getSprints'
        		}).success(function(res){
            		console.log('Got response: '+JSON.stringify(res));
            		if(res === undefined || res.status === undefined || res.status === 'Failed') {
                		alert('Unable to laod data.');
            		} else if(res.status === 'Success'){
                		$scope.sprints = res.sprints;
            		}
        		})
        	}

        	$scope.scrumInit = function(res){
				$scope.userStories = res.data[0].userStories;
				$scope.projectPageShow = false;
            	$scope.createProjMode  = false;
            	$scope.signInPageShow = false;
            	$scope.scrumPageShow = true;
            	$scope.waterfallPageShow = false;
        		
                console.log($scope.userStories);
                for(var i=0; i<$scope.userStories.length;i++){
                    $scope.visible2[$scope.userStories[i].id] = true;
                }
                $scope.getSprints();
			}

			$scope.editUserStory = function(id){
            	$scope.visible2[id]=!$scope.visible2[id];
        	}


        	$scope.saveStory = function(story){
            	// story.userId = 'k.praveen@outlook.com';
            	// story.projectName = 'Test1'
            	console.log(story);

            	$http({
                	method : 'PUT',
                	url : '/updateUser',
                	data : story
            	}).success(function(res){
                	console.log(res);
                	if(res.status === 'Failed'){
                    	alert(res.error);
                	} else {
                    	alert('Saved successfully.');
                    	$scope.visible2[story.id]=!$scope.visible2[story.id];
                	}
            	})
        	}




    	}

	</script>
</html>